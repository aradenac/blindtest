doctype html
head
  meta(charset='utf8')
  title test audio html5 player
  script(src='https://code.jquery.com/jquery-3.5.0.min.js' integrity='sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=' crossorigin='anonymous')
  script(src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js')
  script(src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js")

audio#audioPlayer
  |           Your browser does not support the audio tag

p#serverMessage yolo
input#answer

script.
  var $srvMsg = $('#serverMessage');

  var $player = $('#audioPlayer');
  var player = $player[0];

  var socket = io();

  socket.on('connect', ()=>{
    var cookie = Cookies.get();
    socket.emit('setCookie', JSON.stringify(cookie));
    console.log(`send cookie ${cookie}`);
  })


  $answer = $('#answer');

  $answer.on('keyup', (event)=>{
    if (event.keyCode == 13) {
      event.preventDefault();
      submitAnswer();
    }
  })

  socket.on('answerResponse', (result) => {
    console.log(`server answer eval: ${result}`);
    $srvMsg.text(`${result}`);
  });

  socket.on('startSong', (song) => {
    console.log(`server order play song: ${song}`);
    player.src = 'music/'+song;
    player.load();
    player.play();
    $answer.val('');
    $srvMsg.text('');
  });

  socket.on('stopSong', ()=>{
    console.log('server order stop song');
    player.pause();
  });

  $player.on('canplaythrough', () => {
    // notify server
  });

  function submitAnswer() {
    var answer = $('#answer').val();

    console.log(`submit answer: ${answer}`);

    var userSession = Cookies.get('userSession');

    socket.emit('submitAnswer', {answer: answer, userSession: userSession});
  }

  function changeTrack() {
    player.src = '../music/m1.mp3';
    player.load();
  }

  function playTrack() {
    player.play();
    setTimeout(changeTrack, 3000);
  }

  changeTrack();


  /*
  $player.on('canplaythrough', ()=>{
    player.play();
  })*/
